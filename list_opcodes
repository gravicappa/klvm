#!/bin/sh
exclude="
 klvm.s2.walk klvm.s1.func klvm.s1.closure klvm.s1.toplevel klvm.s1.return"
dir="$(dirname "$0")"
cat "$dir"/stage-2.shen \
| awk -v e="$exclude" '
BEGIN {
  FS = "[ ()\\[\\]]"
  split(e, ea, /[ \n\r\t]/)
  for (x in ea)
    if (ea[x] != "")
      exclude[ea[x]] = 1
}
/^\(package/ {inpackage = 1; next}
/^[a-zA-Z()]/ {inpackage = 0}
!inpackage {
  for (i = 1; i <= NF; ++i)
    if (($i != "") && ($i ~ /^klvm\./) && !($i in exclude))
      op[$i] = 1
}
END {
  for (x in op)
    print(x)
}' | sort
